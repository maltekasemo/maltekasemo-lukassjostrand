import json
import sys
from Queries import *
from building_dictionaries import build_tram_network

STOPS_JSON_FILE = 'venv/tramstops.json'
TRAMLINES_TSV_FILE = 'venv/tramlines.tsv'


def dialogue():
    infile = 'tramnetwork.json'
    with open(infile, 'r') as data:
        tramworks = json.load(data)

    running = True
    while running:
        input_string = input("The following formats are functioning:\nvia <stop>\nbetween <stop1> and <stop2>"
                             "\ntime with <line> from <stop1> to <stop2>\ndistance from <stop1> to <stop2>\nquit\n> ")
        if "via" in input_string:
            station = input_string.lstrip(' via ')
            station.lstrip().rstrip()
            answer = Queries.lines_via_stop(tramworks['lines'], station)
        elif 'between' in input_string and 'and' in input_string:
            stop1_and_stop2 = input_string.split('between')[1]
            stops = stop1_and_stop2.split(' and ')
            stop1 = stops[0].lstrip().rstrip()
            stop2 = stops[1].lstrip().rstrip()
            answer = Queries.lines_between_stops(tramworks['lines'], stop1, stop2)
        elif 'time with' in input_string and 'from' in input_string and 'to' in input_string:
            line_and_stops = input_string.lstrip('time with ')
            line = line_and_stops.split('from')[0].lstrip().rstrip()
            stops = line_and_stops.split('from')[1]
            stop1 = stops.split(' to ')[0].lstrip().rstrip()
            stop2 = stops.split(' to ')[1].lstrip().rstrip()
            print(line, stop1, stop2)
            answer = Queries.times_between_stops(tramworks['lines'], tramworks['times'], line, stop1, stop2)
        elif 'distance from' in input_string and 'to' in input_string:
            stop1_and_stop2 = input_string.lstrip('distance from')
            stops = stop1_and_stop2.split(' to ')
            stop1 = stops[0].rstrip().lstrip()
            stop2 = stops[1].rstrip().lstrip()
            answer = Queries.distance_between_stops(tramworks['stops'], stop1, stop2)
        elif input_string == 'quit':
            print("Byebye, see you next time")
            answer = None
            running = False
        else:
            print("Sorry, try again")
            answer = None
        if answer:
            print(answer)

if __name__ == '__main__':
   build_tram_network()
